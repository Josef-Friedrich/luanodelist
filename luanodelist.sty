\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{luanodelist}
\RequirePackage{luatexbase-mcb}

\DeclareOption{log}{\directlua{output_way = 'log'}}
\DeclareOption{term}{\directlua{output_way = 'term'}}
\DeclareOption{termandlog}{\directlua{output_way = 'term and log'}}

\newcommand{\setcallback}[1]{\directlua{debug_callback = '#1'}}

\ProcessOptions\relax

\directlua{
  require("luanodelist")

  inspector = function(head)
    luanodelist.nodelist_visualize(head)
    return true
  end

  if not debug_callback then
    debug_callback = 'post_linebreak_filter'
  end

  luatexbase.add_to_callback(debug_callback, inspector, "inspector")
}

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{luanodelist}
\RequirePackage{luatexbase-mcb}
\RequirePackage{kvoptions}

\SetupKeyvalOptions{
  family=LN,
  prefix=LN@
}

\DeclareStringOption[term and log]{channel}
\DeclareStringOption[postlinebreak]{callback}

\ProcessKeyvalOptions*

\newcommand{\setluanodelist}[1]{\setkeys{LN}{#1}}

\directlua{
  require("luanodelist")

  channel = '\LN@channel'

  inspector = function(head)
    luanodelist.nodelist_visualize(head)
    return true
  end

  luatexbase.add_to_callback(luanodelist.get_luatex_callback("\LN@callback"), inspector, "inspector")
}

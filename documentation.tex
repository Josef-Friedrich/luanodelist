%!TEX program = lualatex
\documentclass{ltxdoc}
\usepackage{paralist,fontspec,graphicx,fancyvrb}
\usepackage[
  colorlinks=true,
  linkcolor=red,
  filecolor=red,
  urlcolor=red,
]{hyperref}
\usepackage{nodetree-embed}
\EnableCrossrefs
\CodelineIndex
\RecordChanges

\usepackage{minted}
\usemintedstyle{colorful}
\BeforeBeginEnvironment{minted}{\begin{mdframed}[backgroundcolor=gray!3]}
\AfterEndEnvironment{minted}{\end{mdframed}}
\setminted{
  breaklines=true,
  fontsize=\footnotesize,
}

\def\TmpLuaCodeInline#1{\texttt{\scantokens{\catcode`\_=12\relax#1}}}

\def\TmpSecRef#1{(\rightarrow\ \ref{#1})}

\def\TmpPageSecRef#1{
  Page
  \pageref{#1},
  Section
  \ref{#1}
}

\newcommand{\TmpGraphics}[1]{
  \noindent
  \includegraphics[scale=0.4]{graphics/#1}
}

\newcommand{\TmpExample}[1]{
\begin{NodetreeExample}
\input{examples/#1.nttex}
\end{NodetreeExample}
}

\newcommand{\TmpVerbExample}[1]{
\VerbatimInput[frame=single,fontsize=\footnotesize,firstline=4]{examples/#1.tex}
\TmpExample{#1}
}

\DefineVerbatimEnvironment{code}{Verbatim}
{
  frame=single,
  fontsize=\footnotesize,
}

\newcommand{\TmpLuaFunction}[1]{
  \marginpar{%
    \raggedleft%
    \MacroFont%
    \texttt{%
      \scantokens{\catcode`\_=12\relax#1}%
    }%
  }%
}

\begin{document}

\providecommand*{\url}{\texttt}
\GetFileInfo{nodetree.dtx}
\title{The \textsf{nodetree} package}
\author{%
  Josef Friedrich\\%
  \url{josef@friedrich.rocks}\\%
  \href{https://github.com/Josef-Friedrich/nodetree}{github.com/Josef-Friedrich/nodetree}%
}
\date{v.1.2 from 2020/05/03}

\maketitle

\begin{NodetreeEmbed}
nodetree
\end{NodetreeEmbed}

\newpage

\tableofcontents

\newpage

%-----------------------------------------------------------------------
% Abstract
%-----------------------------------------------------------------------

\section{Abstract}

|nodetree| is a development package that visualizes the structure of
node lists. |nodetree| shows its debug informations in the consoles’
output when you compile a Lua\TeX{} file. It uses a similar visual
representation for node lists as the UNIX |tree| command does for a
folder tree.

Node lists are the main building blocks of each document generated by
the \TeX{} engine \emph{Lua\TeX}. The package |nodetree| doesn‘t change
the rendered document. The tree view can only be seen when using a
terminal to generate the document.

|nodetree| is inspired by a
\href{https://gist.github.com/pgundlach/556247}
{gist from Patrick Gundlach}.

%-----------------------------------------------------------------------
% Usage
%-----------------------------------------------------------------------

\section{Usage}

The package |nodetree| has three usage scenarios.
It can be used as a standalone Lua module, as a plain Lua\TeX{} or a
Lua\LaTeX{} package.

%-----------------------------------------------------------------------
%
%-----------------------------------------------------------------------

\newpage

\subsection{As a plain Lua\TeX{} package}

Run |luatex luatex-test.tex| for example to list the nodes using
Lua\TeX{}.

\begin{minted}{latex}
\input{nodetree.tex}
\NodetreeRegisterCallback{postline}

Lorem ipsum dolor.
\bye
\end{minted}

\subsubsection{Available macros}

\def\TmpTabularMacrosPlainTeX{
\cmd{\NodetreeRegisterCallback}\marg{callbacks} &
\TmpPageSecRef{sec:macro:nodetree-register-callback} \\

\cmd{\NodetreeUnregisterCallback}\marg{callbacks} &
\TmpPageSecRef{sec:macro:nodetree-unregister-callback} \\

\cmd{\NodetreeSetOption}\oarg{option}\marg{value} &
\TmpPageSecRef{sec:macro:nodetree-set-option} \\
}

\begin{tabular}{ll}
\textbf{Macro name} &
\textbf{Reference} \\

\TmpTabularMacrosPlainTeX

\end{tabular}

\subsubsection{Available options}

\def\TmpTabularOptionsBase{
|callback| &
\TmpPageSecRef{sec:option:callback} \\

|channel| &
\TmpPageSecRef{sec:option:channel} \\

|verbosity| &
\TmpPageSecRef{sec:option:verbosity} \\

|color| &
\TmpPageSecRef{sec:option:color} \\

|unit| &
\TmpPageSecRef{sec:option:unit} \\

|decimalplaces| &
\TmpPageSecRef{sec:option:decimalplaces} \\
}

\begin{tabular}{ll}
\textbf{Option name} &
\textbf{Reference} \\

\TmpTabularOptionsBase
\end{tabular}

%-----------------------------------------------------------------------
%
%-----------------------------------------------------------------------

\newpage

\subsection{As a Lua\LaTeX{} package}

Or run |lualatex lualatex-test.tex| to show a node tree using
Lua\LaTeX{}. In Lua\LaTeX{} you can omit |\NodetreeRegisterCallback{postline}|.
|\usepackage{nodetree}| registers automatically the
|post_linebreak_filter|. If you don’t want debug the
|post_linebreak_filter| use |\NodetreeUnregisterCallback{postline}|.

\begin{minted}{latex}
\documentclass{article}
\usepackage{nodetree}

\begin{document}
Lorem ipsum dolor.
\end{document}
\end{minted}

\subsubsection{Available macros}

\begin{tabular}{ll}
\textbf{Macro name} &
\textbf{Reference} \\

\TmpTabularMacrosPlainTeX

\cmd{\NodetreeSet}\marg{kv-options} &
\TmpPageSecRef{sec:macro:nodetree-set} \\
\end{tabular}

\subsubsection{Available options}

\begin{tabular}{ll}
\textbf{Option name} &
\textbf{Reference} \\

\TmpTabularOptionsBase
\end{tabular}

%-----------------------------------------------------------------------
%
%-----------------------------------------------------------------------

\newpage

\subsection{As a Lua module}

Import the Lua module of the package inside
\mintinline{latex}{\directlua{}}
with this command:
\mintinline{lua}{local nodetree = require('nodetree')}.
Then use the Lua function
\mintinline{lua}{nodetree.print(head, options)}
to debug nodes inside your Lua code.

\begin{minted}{lua}
local nodetree = require('nodetree')

local rule1 = node.new('rule')
rule1.width  = 20 * 65536
rule1.height = 10 * 65536
rule1.depth  = 10 * 65536
nodetree.print(vbox)
\end{minted}

\noindent
The function \mintinline{lua}{nodetree.print()} takes as a second
argument a Lua table to configure the output.

\begin{minted}{lua}
nodetree.print(vbox, { verbosity = 2, unit = 'cm' })
\end{minted}

\noindent
This are the default options:

\begin{minted}{lua}
options =  {
  verbosity = 1,
  callback = 'post_linebreak_filter',
  engine = 'luatex',
  color = 'colored',
  decimalplaces = 2,
  unit = 'pt',
  channel = 'term'
}
\end{minted}

\noindent
The following code snippet demonstrates the usage in Lua\TeX{}.
|head| is the current node.

\begin{minted}{latex}
  \directlua{
  local nodetree = require('nodetree')
  local test = function (head)
    nodetree.print(head)
  end
  callback.register('post_linebreak_filter', test)
}

Lorem ipsum dolor.
\bye
\end{minted}

\noindent
This example illustrates how the function has to be applied in
Lua\LaTeX{}.

\begin{minted}{latex}
\documentclass{article}
\usepackage{nodetree}

\begin{document}

\directlua{
  local nodetree = require('nodetree')
  local test = function (head)
    nodetree.print(head)
  end
  luatexbase.add_to_callback('post_linebreak_filter', test, 'test')
}

Lorem ipsum dolor.
\end{document}
\end{minted}

%-----------------------------------------------------------------------
%
%-----------------------------------------------------------------------

\newpage
\subsection{The package \texttt{nodetree-embed}}

The single purpose of this auxiliary package is to provide a view
similar to a terminal (console) output.
This view mimics the output
of |nodetree| in a terminal.
The view can be embedded in a Lua\LaTeX{} file. You have to
compile documents using this embedded view with the option
|--shell-escape|.
The main environment of this package is |NodetreeEmbed|.
Markup
inside this environment is written into a temporary \LaTeX{} file.
This file is compiled in the background by |latexmk| and the
|nodetree| output is embded into this view.
The following list shows the single intermediate steps:

\begin{enumerate}

\item |jobname.tex|

\begin{minted}{latex}
\begin{NodetreeEmbed}
nodetree
\end{NodetreeEmbed}
\end{minted}

\item |_nodetree-jobname/1.tex|

\begin{minted}{latex}
%!TEX program = lualatex
\documentclass{article}
\usepackage{nodetree}
\NodetreeSetOption[channel]{tex}
\NodetreeSetOption[verbosity]{1}
\NodetreeSetOption[unit]{pt}
\NodetreeSetOption[decimalplaces]{2}
\NodetreeUnregisterCallback{post_linebreak_filter}
\NodetreeRegisterCallback{post_linebreak_filter}
\begin{document}
nodetree
\end{document}
\end{minted}

\item |_nodetree-jobname/1.nttex|: This temporary Lua\LaTeX file is
compiled using |latexmk| and embed in the environment |NodetreeEmbed|

\begin{minted}{latex}
\par{}\par{}Callback: \textcolor{NTEred}{post\_linebreak\_filter}\par{}
------------------------------------------\par{}
\mbox{├─\textcolor{NTEmagentabright}{GLUE\hspace{0.5em}}\textcolor{NTEyellow}{subtype:} baselineskip, \textcolor{NTEyellow}{width:} 5.06\textcolor{NTEwhite}{pt}}\par{}
...
\end{minted}

\item Finally the result:

\begin{NodetreeEmbed}
nodetree
\end{NodetreeEmbed}

\end{enumerate}

\subsubsection{Available options}

\begin{tabular}{ll}
\textbf{Option name} &
\textbf{Reference} \\

\TmpTabularOptionsBase

|theme| &
\TmpPageSecRef{sec:option:theme} \\

|thememode| &
\TmpPageSecRef{sec:option:thememode} \\

|font| &
\TmpPageSecRef{sec:option:font} \\

|fontsize| &
\TmpPageSecRef{sec:option:fontsize} \\
\end{tabular}

%-----------------------------------------------------------------------
% Macros
%-----------------------------------------------------------------------
\newpage
\section{Macros}

%%
% \NodetreeRegisterCallback
%%

\subsection{\cmd{\NodetreeRegisterCallback}}
\label{sec:macro:nodetree-register-callback}

\DescribeMacro{\NodetreeRegisterCallback}
\cmd{\NodetreeRegisterCallback}\marg{callbacks}: The argument \marg{callbacks}
takes a comma separated list of callback aliases as described in
\TmpSecRef{sec:option:callback}.

%%
% \NodetreeUnregisterCallback
%%

\subsection{\cmd{\NodetreeUnregisterCallback}}
\label{sec:macro:nodetree-unregister-callback}

\DescribeMacro{\NodetreeUnregisterCallback}
\cmd{\NodetreeUnregisterCallback}\marg{callbacks}: The argument \marg{callbacks}
takes a comma separated list of callback aliases as described in
\TmpSecRef{sec:option:callback}.

%%
% \NodetreeSetOption
%%

\subsection{\cmd{\NodetreeSetOption}}
\label{sec:macro:nodetree-set-option}

\DescribeMacro{\NodetreeSetOption}
\cmd{\NodetreeSetOption}\oarg{option}\marg{value}: \TmpSecRef{sec:options}
This macro sets a single \oarg{option} to \marg{value}.

%%
% \NodetreeResetOption
%%

\subsection{\cmd{\NodetreeResetOption}}
\label{sec:macro:nodetree-set-option}

\DescribeMacro{\NodetreeResetOption}
\cmd{\NodetreeResetOption}\marg{option}: \TmpSecRef{sec:options}
This macro resets a single \marg{option} to its default value.

%%
% \NodetreeSet
%%

\subsection{\cmd{\NodetreeSet}}
\label{sec:macro:nodetree-set}

\DescribeMacro{\NodetreeSet}
\cmd{\NodetreeSet}\marg{kv-options}:
This macro sets multiple options a once. It only can be used along with
 Lua\LaTeX{}. \marg{kv-options} are key value pairs.

\begin{code}
\NodetreeSet{color=no,callbacks={hpack,vpack},verbosity=2}
\end{code}

%-----------------------------------------------------------------------
% Options
%-----------------------------------------------------------------------
\newpage
\section{Options}
\label{sec:options}

%%
% callback
%%

\subsection{Option \texttt{callback}}
\label{sec:option:callback}

The option |callback| is the most important setting of the package. It
is possible to specify an alias to select the |callback|. Take a look
the overview of callbacks (\rightarrow{} Figure \ref{fig:callback}).
|nodetree| supports all node related callbacks as listed in the
Lua\TeX reference manual.

This macros process callback options:
\cmd{\NodetreeRegisterCallback}\marg{callbacks},
\cmd{\NodetreeUnregisterCallback}\marg{callbacks},
\cmd{\NodetreeSet}\marg{callback=<callbacks>} and
\cmd{\usepackage}\oarg{callback=<callbacks>}\marg{nodetree}.

Use commas to specify mulitple callbacks. Avoid using whitespaces:

\begin{code}
\NodetreeRegisterCallback{preline,line,postline}
\end{code}

Wrap your callback aliases in curly braces for the macro |\NodetreeSet|:

\begin{code}
\NodetreeSet{callback={preline,line,postline}}
\end{code}

The same applies for the macro |\usepackage|:

\begin{code}
\usepackage{callback={preline,line,postline}}
\end{code}

%%
% Tabular callbacks
%%

\newcommand{\TmpCallbackRow}[3]{
  \TmpLuaCodeInline{#1} & \TmpLuaCodeInline{#2} & \TmpLuaCodeInline{\footnotesize#3} \\
}

\begin{figure}
The callbacks are listed in the same order as in the Lua\TeX reference
manual.

\noindent
\begin{tabular}{lll}
\textbf{Callback} & \textbf{Alias} & \textbf{Alias (longer)} \\
\TmpCallbackRow{contribute_filter}
{contribute}
{contributefilter}

\TmpCallbackRow{buildpage_filter}
{buildfilter} %
{buildpagefilter}

% new
\TmpCallbackRow{build_page_insert}
{buildinsert}
{buildpageinsert}

\TmpCallbackRow{pre_linebreak_filter}
{preline}
{prelinebreakfilter}

\TmpCallbackRow{linebreak_filter}
{line}
{linebreakfilter}

\TmpCallbackRow{append_to_vlist_filter}
{append}
{appendtovlistfilter}

\TmpCallbackRow{post_linebreak_filter}
{postline}
{postlinebreakfilter}

\TmpCallbackRow{hpack_filter}
{hpack}
{hpackfilter}

\TmpCallbackRow{vpack_filter}
{vpack}
{vpackfilter}

\TmpCallbackRow{hpack_quality}
{hpackq}
{hpackquality}

\TmpCallbackRow{vpack_quality}
{vpackq}
{vpackquality}

\TmpCallbackRow{process_rule}
{process}
{processrule}

\TmpCallbackRow{pre_output_filter}
{preout}
{preoutputfilter}

\TmpCallbackRow{hyphenate}
{hyph}
{}

\TmpCallbackRow{ligaturing}
{liga}
{}

\TmpCallbackRow{kerning}
{kern}
{}

\TmpCallbackRow{insert_local_par}
{insert}
{insertlocalpar}

\TmpCallbackRow{mlist_to_hlist}
{mhlist}
{mlisttohlist}
\end{tabular}

\caption{The callback aliases}
\label{fig:callback}
\end{figure}

%%
% channel
%%

\subsection{Option \texttt{channel}}
\label{sec:option:channel}

You can select the debug output channel with this option. The default
value for the option |channel| is |term| which displays the node tree in
the current terminal. Specify |log| and the package creates a log file
named |jobname.ntlog|. Specify |tex| and a log file named
|jobname.nttex| is creatred. |nt...| stands for |nodetree|.
|jobname| is the basename of your file you want to debug. The debug
channel is only useful for the auxiliary package |nodetree-embed|. Paste
the markup in the environment |NodetreeExample| and you get a
terminal like view in your document.

%%
% verbosity
%

\subsection{Option \texttt{verbosity}}
\label{sec:option:verbosity}

Higher integer values result in a more verbose output. The default value
for this options is |1|. At the moment only verbosity level |2| is
implemented.

\def\TmpExampleVerbosity#1{
  \subsubsection{Example: \texttt{verbosity=#1}}
  \begin{NodetreeEmbed}[verbosity=#1,callback=pre_linebreak_filter]
  .
  \end{NodetreeEmbed}
}

\TmpExampleVerbosity{1}
\TmpExampleVerbosity{2}

%%
% color
%%

\subsection{Option \texttt{color}}
\label{sec:option:color}

The default option for |color| is |colored|. Use any other string (for
example |none| or |no|) to disable the colored terminal output of the
package.

\begin{code}
\usepackage[color=no]{nodetree}
\end{code}

%%
% unit
%%

\subsection{Option \texttt{unit}}
\label{sec:option:unit}

The option |unit| sets the length unit to display all length values of
the nodes. The default option for |unit| is |pt|. See figure
\ref{fig:fixed-units} and \ref{fig:relative-units} for possible values.

\begin{figure}
\begin{tabular}{lp{10cm}}
\textbf{Unit} &
\textbf{Description} \\

pt &
Point 1/72.27 inch. The conversion to metric units, to two decimal
places, is 1 point = 2.85 mm = 28.45 cm. \\

pc &
Pica, 12 pt \\

in &
Inch, 72.27 pt \\

bp &
Big point, 1/72 inch. This length is the definition of a point in
PostScript and many desktop publishing systems. \\

cm &
Centimeter \\

mm &
Millimeter \\

dd &
Didot point, 1.07 pt \\

cc &
Cicero, 12 dd \\

sp &
Scaled point, 1/65536 pt \\
\end{tabular}
\caption{Fixed units}
\label{fig:fixed-units}
\end{figure}

\begin{figure}
\begin{tabular}{lp{10cm}}
\textbf{Unit} &
\textbf{Description} \\

ex &
x-height of the current font \\

em &
Width of the capital letter M \\
\end{tabular}
\caption{Relative units}
\label{fig:relative-units}
\end{figure}

\NodetreeSetOption[verbosity]{1}

\def\TmpExampleUnit#1{
  \subsubsection{Example: \texttt{unit=#1}}
  \begin{NodetreeEmbed}[unit=#1,callback=pre_linebreak_filter]
  Lorem.
  \end{NodetreeEmbed}
}

\TmpExampleUnit{pt}
\TmpExampleUnit{sp}
\TmpExampleUnit{cm}

%%
% decimalplaces
%%

\subsection{Option \texttt{decimalplaces}}
\label{sec:option:decimalplaces}

The options |decimalplaces| sets the number of decimal places for some
node fields. If |decimalplaces| is set to |0| only integer values are shown.

\begin{code}
\NodetreeSetOption[decimalplaces]{4}
\end{code}

\def\TmpExampleDecimalplaces#1{
  \subsubsection{Example: \texttt{decimalplaces=#1}}
  \begin{NodetreeEmbed}[unit=cc,decimalplaces=#1,callback=pre_linebreak_filter]
  Lorem.
  \end{NodetreeEmbed}
}

\TmpExampleDecimalplaces{0}
\TmpExampleDecimalplaces{2}
\TmpExampleDecimalplaces{5}

\NodetreeReset

%%
% theme and thememode
%%

\def\TmpExampleTheme#1#2{
  \subsubsection{Example: \texttt{theme=#1} \texttt{thememode=#2}}
  \begin{NodetreeEmbed}[callback=pre_linebreak_filter,theme=#1,thememode=#2,fontsize=\small]
  .
  \end{NodetreeEmbed}
}

\subsection{Option \texttt{theme} and \texttt{thememode}}
\label{sec:option:theme}
\label{sec:option:thememode}

% bw
\TmpExampleTheme{bwdark}{dark}
\TmpExampleTheme{bwlight}{light}

% monokaisoda
\TmpExampleTheme{monokaisoda}{dark}
\TmpExampleTheme{monokaisoda}{light}

\NodetreeReset

%%
% font
%%

\subsection{Option \texttt{font}}
\label{sec:option:font}

\NodetreeSet{fontsize=\small}

\def\TmpExampleFont#1{
  \subsubsection{Example: \texttt{font=\{#1\}}}
  \begin{NodetreeEmbed}[font={#1}]
  .
  \end{NodetreeEmbed}
}

|nodetree-embed| passes the option |font| down to the
command |\setmonofont{}| of the |fontspec| package. The used font
should be a monospaced and have some box drawing glyphs (See table
UNICODE glyphs \ref{fig:unicode}).

\TmpExampleFont{Liberation Mono}
\TmpExampleFont{Ubuntu Mono}

\NodetreeReset

%%
% fontsize
%%

\subsection{Option \texttt{fontsize}}
\label{sec:option:fontsize}

\def\TmpExampleFontSize#1{
  \subsubsection{Example: \string#1}
  \begin{NodetreeEmbed}[callback=pre_linebreak_filter,fontsize=#1]
  .
  \end{NodetreeEmbed}
}

\TmpExampleFontSize{\small}
\TmpExampleFontSize{\tiny}

\NodetreeReset

%-----------------------------------------------------------------------
% Visual tree structure
%-----------------------------------------------------------------------
\newpage
\section{Visual tree structure}

%%
% Two different connections
%%

\subsection{Two different connections}

Nodes in Lua\TeX{} are connected. The |nodetree| package distinguishs
between the |list| and |field| connections.

\begin{itemize}
 \item |list|: Nodes, which are double connected by |next| and
       |previous| fields.
 \item |field|: Connections to nodes by other fields than |next| and
       |previous| fields, e. g. |head|, |pre|.
\end{itemize}

%%
% Unicode characters
%%

\subsection{Unicode characters to show the tree view}

\renewcommand{\arraystretch}{1.5}

The package |nodetree| uses the unicode box drawing symbols. Your
default terminal font should contain this characters to obtain the tree
view. Eight box drawing characters are necessary.

\begin{figure}
{
\fontspec{DejaVu Sans Mono}
\begin{tabular}{lcl}
\textbf{Code} & \textbf{Character} & \textbf{Name} \\
U+2500 & ─ & BOX DRAWINGS LIGHT HORIZONTAL \\
U+2502 & │ & BOX DRAWINGS LIGHT VERTICAL \\
U+2514 & └ & BOX DRAWINGS LIGHT UP AND RIGHT \\
U+251C & ├ & BOX DRAWINGS LIGHT VERTICAL AND RIGHT \\
U+2550 & ═ & BOX DRAWINGS DOUBLE HORIZONTAL \\
U+2551 & ║ & BOX DRAWINGS DOUBLE VERTICAL \\
U+255A & ╚ & BOX DRAWINGS DOUBLE UP AND RIGHT \\
U+2560 & ╠ & BOX DRAWINGS DOUBLE VERTICAL AND RIGHT \\
\end{tabular}
}
\caption{The UNICODE box drawings glyphs}
\label{fig:unicode}
\end{figure}

\noindent
For |list| connections \emph{light} characters are shown.

{
\setmonofont{DejaVu Sans Mono}
\begin{code}
│ │
│ ├─list1
│ └─list2
└─list3
\end{code}
}

\noindent
|field| connections are visialized by \emph{Double} characters.

{
\setmonofont{DejaVu Sans Mono}
\begin{code}
║ ║
║ ╠═field1
║ ╚═field2
╚═field3
\end{code}
}

%-----------------------------------------------------------------------
% Examples
%-----------------------------------------------------------------------
\newpage
\section{Examples}

\NodetreeReset

In this section lists some examples of the |nodetree| output.

%%
% packagename
%%

\subsection{The node list of the package name}

\begin{NodetreeEmbed}[showmarkup=true,callback=post_linebreak_filter]
nodetree
\end{NodetreeEmbed}

%%
% math
%%

\subsection{The node list of a mathematical formula}

\TmpVerbExample{math}

% \begin{NodetreeEmbed}
% \[\left(a\right)\left[\frac{b}{a}\right]=a\]
% \end{NodetreeEmbed}

%%
% ligatures
%%

\subsection{The node list of the word \emph{Office}}

The characters \emph{ffi} are deeply nested in a discretionary node.

\begin{NodetreeEmbed}[showmarkup=true]
Office
\end{NodetreeEmbed}

%-----------------------------------------------------------------------
% Node types
%-----------------------------------------------------------------------

\subsection{Node types}

This chapter shows some node types in a |nodetree| view.

\newcommand{\TmpHeadingNodeTypeSub}[4]{
  \subsubsection{Type: \texttt{#1(#2)} Subtype: \texttt{#3(#4)}}
}

\newcommand{\TmpNodeTypeSub}[4]{
  \subsubsection{Type: #1(#2) Subtype: #3(#4)}
  \TmpVerbExample{#2#1#4#3}
}

\newcommand{\TmpNodeType}[2]{
  \subsubsection{Type: #1(#2)}
  \TmpVerbExample{#2#1}
}

\newcommand{\TmpHeadingNodeType}[2]{
  \subsubsection{Type: \texttt{#1(#2)}}
}

%%
%
%%

\TmpHeadingNodeTypeSub{hlist}{0}{line}{1}

\begin{NodetreeEmbed}[showmarkup=true]
Lorem
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeTypeSub{hlist}{0}{box}{2}

\begin{NodetreeEmbed}[showmarkup=true]
L\hbox to 40pt{ore}m
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeTypeSub{hlist}{0}{indent}{3}

\begin{NodetreeEmbed}[showmarkup=true,unit=cm]
\setlength{\parindent}{5cm}
I
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeType{vlist}{1}

\begin{NodetreeEmbed}[showmarkup=true]
L\vbox to 40pt{O}L
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeType{rule}{2}

\begin{NodetreeEmbed}[showmarkup=true,unit=mm]
\rule[-2mm]{10mm}{4mm}
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeType{mark}{4}

\begin{NodetreeEmbed}[showmarkup=true,callback=pre_output_filter]
\mark{Lorem}.
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeTypeSub{disc}{7}{discretionary}{0}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
L\-O\-L
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeTypeSub{disc}{7}{regular}{3}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
Office
\end{NodetreeEmbed}

\TmpNodeTypeSub{whatsit}{8}{pdfaction}{22}
\TmpNodeTypeSub{whatsit}{8}{pdfcolorstack}{28}

%%
%
%%

\TmpHeadingNodeTypeSub{glue}{12}{baselineskip}{2}

\NodetreeReset

\NodetreeEmbedCmd[showmarkup=true,unit=cm]{
\baselineskip=5cm
Lorem

Lorem
}

%%
%
%%

\TmpHeadingNodeTypeSub{glue}{12}{parskip}{3}

\NodetreeReset
\NodetreeEmbedCmd[showmarkup=true]{
\parskip=5cm
Lorem

Lorem
}
%%
%
%%

\TmpHeadingNodeTypeSub{glue}{12}{spaceskip}{13}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
\spaceskip=5cm
a a
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeTypeSub{glue}{12}{leaders}{100}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
a \leavevmode\leaders\hbox{ . }\hfill\kern0pt a
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeTypeSub{glue}{12}{cleaders}{101}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
a \leavevmode\cleaders\hbox{ . }\hfill\kern0pt a
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeTypeSub{glue}{12}{xleaders}{102}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
a \leavevmode\xleaders\hbox{ . }\hfill\kern0pt a
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeTypeSub{glue}{12}{gleaders}{102}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
a \leavevmode\gleaders\hbox{ . }\hfill\kern0pt a
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeTypeSub{kern}{13}{userkern}{0}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
a\kern2pt
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeTypeSub{kern}{13}{fontkern}{1}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
Ve
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeTypeSub{kern}{13}{accentkern}{2}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
\`{a}
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeTypeSub{kern}{13}{italiccorrection}{3}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
\textit{L}\/OL
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeType{penalty}{14}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
L \penalty 23 OL
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeType{glyph}{29}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
abc
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeType{attribute}{38}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
{\attribute0=1 A}
\end{NodetreeEmbed}

%%
%
%%

\TmpHeadingNodeType{attributelist}{40}

\NodetreeReset
\begin{NodetreeEmbed}[showmarkup=true]
{\attribute0=1 A}
\end{NodetreeEmbed}

\DocInput{nodetree.dtx}

\subsection{The file nodetree.lua}

\inputminted{lua}{nodetree.lua}

%-----------------------------------------------------------------------
% Index
%-----------------------------------------------------------------------

\pagebreak
\PrintChanges
\pagebreak
\PrintIndex
\end{document}
